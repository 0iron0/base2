// JavaScript Document
new function(_8){var html5=base2.global.html5=new base2.Package(this,{name:"html5",version:"0.1",imports:"Function2,DOM,jsb",exports:"element,template"});eval(this.imports);var _5=0,_0=1,_1=2;var _4=Math.pow(2,32)-1,_6=/[\[\u02d1\u00b7\]]/,_7=/([\/(){}|*+-.,^$?\\])/g;function _2(a,c,b){return repetitionTemplate.dispatchEvent(a,c,{element:b})};function _3(a){var c=DocumentEvent.createEvent(document,"Events");c.initEvent("BlocksModified",false,false);this.dispatchEvent(a.parentNode,c)};var element=behavior.extend({"repeat-min":0,"repeat-max":_4,"repeat-start":1,indexes:{},addRepetitionBlock:function(a,c){assertArity(arguments);var b=0;var d=a;while(d=d.previousSibling){if(this.getRepetitionTemplate(d)==a){if(this.getRepetitionIndex(d)>=this.getRepetitionIndex(a)){this.setRepetitionIndex(a,this.getRepetitionIndex(d)+1)}b++}}if(b>=this.get(a,"repeat-max")){return null}var d=a.cloneNode(true);var e=_6.test(a.id)?"":a.id;if(e){var g;var i=e.replace(_7,"\\$1");var j=new RegExp("[\\[\\u02d1]"+i+"[\\u00b7\\]]","g");var k=this.getRepetitionIndex(a);var f=document.createElement("div");if(a.nodeName=="TR"){var h=document.createElement("table");h.appendChild(d);f.appendChild(h)}else{f.appendChild(d)}f.innerHTML=f.innerHTML.replace(j,k);d=f.getElementsByTagName(a.nodeName)[0];d.setAttribute("repeat-template",e);d.removeAttribute("id")}d.removeAttribute("repeat-start");d.removeAttribute("repeat-min");d.removeAttribute("repeat-max");d.setAttribute("repeat",this.getRepetitionIndex(a));if(c==null){c=a;while(c.previousSibling&&!this.isBlock(c.previousSibling)){c=c.previousSibling}}else{c=c.nextSibling}d.style.display="";c.parentNode.insertBefore(d,c);this.setRepetitionIndex(a,this.getRepetitionIndex(a)+1);_2(a,"added",d);return d},moveRepetitionBlock:function(a,c){assertArity(arguments);if(!c||!this.isBlock(a))return;var b=a;var d=this.getRepetitionTemplate(a);if(c<0){while(c<0&&b.previousSibling&&!this.isTemplate(b)){b=b.previousSibling;if(this.isBlock(b)){c++}}}else{while(c>0&&b.nextSibling&&!this.isTemplate(b)){b=b.nextSibling;if(this.isBlock(b)){c--}}b=b.nextSibling}a.parentNode.insertBefore(a,b);if(d){_2(d,"moved",a)}},removeRepetitionBlock:function(a){assertArity(arguments);var c=this.getRepetitionTemplate(a);a.parentNode.removeChild(a);if(c){_2(c,"removed",a);var b=this.get(c,"repeat-min"),d=this.getRepetitionBlocks(c).length;while(d++<b){this.addRepetitionBlock(c,null)}}},isBlock:function(a){return this.getRepetitionType(a)==_1},isTemplate:function(a){return this.getRepetitionType(a)==_0},getRepetitionBlocks:function(a){var c={length:0};var b=a.parentNode.firstChild;while(b){if(this.getRepetitionTemplate(b)==a){c[c.length++]=b}b=b.nextSibling}return c},getRepetitionType:function(a){if(a&&a.nodeType==1){var c=this.get(a,"repeat");if(c=="template"){return _0}if(this.testValidIndex(c)){return _1}}return _5},getRepetitionIndex:function(a){switch(this.getRepetitionType(a)){case _0:return this.indexes[a.uniqueID]||0;case _1:return Number(this.get(a,"repeat"));default:return 0}},setRepetitionIndex:function(a,c){switch(this.getRepetitionType(a)){case _0:this.indexes[a.uniqueID]=c;break;case _1:this.set(a,"repeat",c);break}return c},getRepetitionTemplate:function(a){if(this.isBlock(a)){if(this.hasAttribute(a,"repeat-template")){var c=this.get(a,"repeat-template");var b=this.querySelector(document,"#"+c)}else{b=a;while((b=b.nextSibling)&&!this.isTemplate(b)){continue}}if(b&&this.isTemplate(b)){return b}}return null},testValidIndex:function(a){return a&&!isNaN(a)&&a>=0&&a<_4}});var template=element.extend({onattach:function(a){a.style.display="none";if(a.parentNode&&a.parentNode.nodeType==1){var c=0;var b=this.get(a,"repeat-start");while(c++<b){this.addRepetitionBlock(a,null)};c=this.getRepetitionBlocks(a).length;while(c++<this.repeatMin){this.addRepetitionBlock(a,null)}}},onadded:_3,onmoved:_3,onremoved:_3});var button=element.extend({getTemplate:function(a){var c=this.get(a,"template");var b=this.querySelector(document,"#"+c);if(b&&this.isTemplate(b)){return b}return null},onclick:function(a,c){c.preventDeafult()}});var add=button.extend({onattach:function(a){if(this.hasAttribute(a,"template")){var c=this.getTemplate(a)}else{var b=a;while(b&&!this.isBlock(b)){b=b.parentNode}if(b){c=this.getRepetitionTemplate(b)}}a.disabled=!c},onclick:function(a,c){c.preventDefault();if(this.hasAttribute(a,"template")){var b=this.getTemplate(a);var d=null}else{d=a;while(d&&!this.isBlock(d)){d=d.parentNode}if(d){b=this.getRepetitionTemplate(d)}}if(b){this.addRepetitionBlock(b,d)}}});var remove=button.extend({onattach:function(a){var c=a;while(c&&!this.isBlock(c)){c=c.parentNode}a.disabled=!c},onclick:function(a,c){c.preventDefault();var b=a;while(b&&!this.isBlock(b)){b=b.parentNode}if(b){this.removeRepetitionBlock(b)}}});var move=button.extend({onattach:function(c){var b=this;function d(){var a=c;while(a&&!b.isBlock(a)){a=a.parentNode}return a};function e(){var a=d();while(a&&(a=a[b.RELATIVE_NODE])&&!b.isBlock(a)){continue}c.disabled=!a};var g=d();if(g){b.addEventListener(g.parentNode,"BlocksModified",e,false)}e()},onclick:function(a,c){c.preventDefault();var b=a;while(b&&!this.isBlock(b)){b=b.parentNode}if(b){this.moveRepetitionBlock(b,this.DIRECTION)}}});var moveup=move.extend({RELATIVE_NODE:"previousSibling",DIRECTION:-1});var movedown=move.extend({RELATIVE_NODE:"nextSibling",DIRECTION:1});if(!detect("Opera"))html5.rules=new RuleList({"button[type=add]":add,"button.html5-add":add,"button[type=remove]":remove,"button.html5-remove":remove,"button[type=move-up]":moveup,"button.html5-move-up":moveup,"button[type=move-down]":movedown,"button.html5-move-down":movedown});eval(this.exports)};