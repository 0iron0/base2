new function(_b){var JSB=new base2.Package(this,{name:"JSB",version:"0.9.1",imports:"Function2,Enumerable,DOM",exports:"Behavior,Rule,RuleList,ExtendedMouse"});eval(this.imports);if(typeof console2=="undefined")console2={log:Undefined,update:Undefined};var _a=detect("MSIE");var _1=200;var _6=200;var _8=0;var _3=/^on(DOM\w+|[a-z]+)$/,_2=/^mouse(up|down)|click$/,_4=/^(focus|blur)$/,_9=/click$/,_0=/^mouse|click$/,_5=/^(key|text)/;var _7=/^[^12]$/;var Behavior=Module.extend(null,{attach:I,detach:I,extend:function(k,f){var e=this.base(k,f);e.EventDelegator=this.EventDelegator||EventDelegator;if(f&&f.EventDelegator){e.EventDelegator=e.EventDelegator.extend(f.EventDelegator)}var g={},j={},i;var h={};var l=new EventListener(new e.EventDelegator(e,h));e.forEach(function(a,b){if(_3.test(b)){g[b.slice(2)]=a}else{if(!i)i={};i[b]=e.prototype[b]}});forEach.detect(k,function(a,b){if(typeOf(a)!="function"){j[b]=a}});var m=document.base2ID;e.attach=function(a){var b=a.base2ID||assignID(a);if(!h[b]){h[b]=true;if(a.id)global["$"+ViewCSS.toCamelCase(a.id)]=a;if(DOM.bind[m])DOM.bind(a);if(g){forEach(g,bind(flip(l.add),l));g=null}for(var c in j){var d=j[c];if(a[c]===undefined&&typeof d!="object"){a.setAttribute(c,d)}else{a[c]=d}}if(i)extend(a,i);if(e.onattach)e.onattach(a);if(e.oncontentready){if(DocumentState.isContentReady(a)){e.oncontentready(a)}else{DocumentState.readyQueue.push({element:a,behavior:e})}}}return a};e.detach=function(a){var b=a.base2ID||assignID(a);if(h[b]){if(e.ondetach)e.ondetach(a);delete h[b]}return a};if(e.init)e.init();return e},EventDelegator:null,dispatchEvent:function(a,b,c){if(typeof b=="string"){var d=b;b=DocumentEvent.createEvent(document,"Events");Event.initEvent(b,d,true,false)}EventTarget.dispatchEvent(a,extend(b,c))},handleEvent:function(a,b,c){c=b.type;var d="on"+c;if(d){if(_0.test(c)){if(!_2.test(c)||_7.test(b.button)){if(c=="mousewheel"){this[d](a,b,b.wheelDelta)}else{this[d](a,b,b.offsetX,b.offsetY,b.screenX,b.screenY)}}}else if(_5.test(c)){this[d](a,b,b.keyCode,b.shiftKey,b.ctrlKey,b.altKey,b.metaKey)}else{this[d](a,b)}}},getComputedStyle:function(a,b){var c=document.defaultView;if(b)return ViewCSS.getComputedPropertyValue(c,a,b);return ViewCSS.getComputedStyle(c,a,null)},getCSSProperty:function(a,b){CSSStyleDeclaration.getPropertyValue(a.style,b)},setCSSProperty:function(a,b,c,d){CSSStyleDeclaration.setProperty(a.style,b,c,d?"important":"")}});forEach([EventTarget,NodeSelector,Node,Element],function(c){c.forEach(function(a,b){if(!Behavior[b]){Behavior[b]=bind(a,c)}})});ClassList.forEach(function(a,b){Behavior[b+"Class"]=bind(a,ClassList)});var Rule=Base.extend({constructor:function(a,b){if(!instanceOf(a,Selector)){a=new Selector(a)}if(!Behavior.ancestorOf(b)){b=Behavior.extend(b)}this.refresh=function(){a.exec(document).forEach(b.attach)};this.toString=a.toString;DocumentState.addRule(a,b)},refresh:Undefined});var RuleList=Collection.extend({constructor:function(a){this.base(extend({},a))},refresh:function(){this.invoke("refresh")}},{Item:Rule});var EventListener=Base.extend({constructor:function(a){this.delegator=a},delegator:null,add:function(a){EventTarget.addEventListener(document,a,this,_4.test(a))},handleEvent:function(a){this.delegator.handleEvent(a)},"@MSIE":{handleEvent:function(a){var b=a.target;if(_0.test(a.type)&&!b.currentStyle.hasLayout){a=extend({},a);a.offsetX-=b.offsetLeft;a.offsetY-=b.offsetTop}this.delegator.handleEvent(a)}},"@Gecko":{handleEvent:function(a){if(_0.test(a.type)){var b=document.getBoxObjectFor(a.target);a.offsetX=a.pageX-b.x;a.offsetY=a.pageY-b.y}this.delegator.handleEvent(a)}}});var EventDelegator=Base.extend({constructor:function(a,b){this.behavior=a;this.attached=b},behavior:null,attached:null,handleEvent:function(a){var b=a.type;var c=this.behavior;if(b=="documentready"){if(c.ondocumentready){forEach(this.attached,bind(c.ondocumentready,c,a))}}else{var d=a.target;if(d&&this.attached[d.base2ID]){c.handleEvent(d,a,b)}}}});var ExtendedMouse=Behavior.extend(null,{handleEvent:function(a,b,c){c=b.type;if(_2.test(c)){var d=this["on"+c];if(d){this[d](a,b,b.button,b.offsetX,b.offsetY,b.screenX,b.screenY)}}else{this.base(a,b)}}});var DocumentState=Behavior.extend({onDOMContentLoaded:function(){this.loaded=true},onkeydown:function(){this.active=this.busy=true},onkeyup:function(){this.active=this.busy=false},onmousedown:function(a,b,c){this.active=this.busy=(b>=0&&b<a.offsetWidth&&c>=0&&c<a.offsetHeight)},onmouseup:function(){this.active=this.busy=false},onmousemove:function(){if(!this.busy)this.setBusyState(true)}},{EventDelegator:{handleEvent:function(a){this.behavior["on"+a.type](a.target,a.offsetX,a.offsetY)}},active:false,busy:false,loaded:false,ready:false,readyQueue:[],rules:new Array2,init:function(){this.attach(document)},addRule:function(a,b){assert(!/:/.test(a),format("Pseudo class selectors not allowed in JSB (selector='%2').",a));var c=Selector.parse(a);this.rules.push({query:c,behavior:b});if(this.rules.length==1)this.recalc()},isContentReady:function(a){if(this.loaded||!a.canHaveChildren)return true;while(a&&!a.nextSibling){a=a.parentNode}return!!a},recalc:function(a,b,c){var d=this.rules;if(!this.busy){var k=this.readyQueue;var f=Date2.now(),e=f,g=0;while(k.length&&(f-e<_1)){var j=k[0];if(this.isContentReady(j.element)){j.behavior.oncontentready(j.element);k.shift()}if(g++<5||g%50==0)f=Date2.now()}var i=d.length;while(i&&d.length&&(f-e<_1)){if(a==null)a=b=0;var h=d[a];var l=h.behavior;var m=false;if(!c){var n=h.query;var o=n.state||[];o.unshift(document,_6);c=n.apply(null,o);m=Array2.item(n.state,-1)}f=Date2.now();var p=c.length,g=0;while(b<p&&(f-e<_1)){l.attach(c[b++]);if(g++<5||g%50==0)f=Date2.now()}if(b==p){b=0;c=null;if(this.loaded&&m){d.removeAt(a)}else a++}if(a>d.length-1)a=0;i--}}if(d.length){setTimeout(bind(this.recalc,this,a,b,c),_8)}else{if(!this.ready)this.fireReady(document)}},fireReady:function(){if(!this.ready){this.ready=true;this.dispatchEvent(document,"documentready")}},setBusyState:function(a){this.busy=this.active||!!a;if(this.busy)setTimeout(bind(this.setBusyState,this),250)}});eval(this.exports)};