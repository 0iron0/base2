new function(_d){var JSB=new base2.Package(this,{name:"JSB",version:"0.9.1",imports:"Function2,Enumerable,DOM",exports:"Behavior,Rule,RuleList,ExtendedMouse"});eval(this.imports);if(typeof console2=="undefined")console2={log:Undefined,update:Undefined};var _c=detect("MSIE");var _2=200;var _8=200;var _a=0;var _5=/^on(DOM\w+|[a-z]+)$/,_3=/^mouse(up|down)|click$/,_6=/^(focus|blur)$/,_b=/click$/,_1=/^mouse|click$/,_7=/^(key|text)/;var _9=/^[^12]$/;var _4=/^(blur|submit|reset|change)$|^(focus|mouse|key)|(click|ready)$/;var Behavior=Module.extend(null,{attach:I,detach:I,extend:function(l,f){var d=this.base(l,f);d.EventDelegator=this.EventDelegator||EventDelegator;if(f&&f.EventDelegator){d.EventDelegator=d.EventDelegator.extend(f.EventDelegator)}var g,i=[],m={},h;var j={};var k=new EventListener(new d.EventDelegator(d,j));if(d.ondocumentready){d._0=[]}d.forEach(function(a,b){if(_5.test(b)){var c=b.slice(2);if(_4.test(c)){i.push(c)}else{if(!g)g=[];g.push(c)}}else{if(!h)h={};h[b]=d.prototype[b]}});forEach.detect(l,function(a,b){if(typeOf(a)!="function"){m[b]=a}});var n=document.base2ID;d.attach=function(a){var b=a.base2ID||assignID(a);if(!j[b]){j[b]=true;if(JSB.globalize&&a.id)global[JSB.globalize+ViewCSS.toCamelCase(a.id)]=a;if(DOM.bind[n])DOM.bind(a);if(i){forEach(i,bind(k.delegate,k));i=null}if(g){forEach(g,bind(k.add,k,a))}for(var c in m){var e=m[c];if(a[c]===undefined&&typeof e!="object"){a.setAttribute(c,e)}else{a[c]=e}}if(h)extend(a,h);if(d.onattach)d.onattach(a);if(d.oncontentready){if(DocumentState.isContentReady(a)){d.oncontentready(a)}else{DocumentState.readyQueue.push({element:a,behavior:d})}}if(d._0){d._0.push(a)}if(a==document.activeElement&&d.onfocus){d.dispatchEvent(a,"focus")}}return a};d.detach=function(a){var b=a.base2ID||assignID(a);if(j[b]){if(d.ondetach)d.ondetach(a);delete j[b]}return a};if(d.init)d.init();return d},EventDelegator:null,dispatchEvent:function(a,b,c){if(typeof b=="string"){var e=b;b=DocumentEvent.createEvent(document,"Events");Event.initEvent(b,e,true,false)}EventTarget.dispatchEvent(a,extend(b,c))},handleEvent:function(a,b,c){c=b.type;var e="on"+c;if(this[e]){if(_1.test(c)){if(!_3.test(c)||_9.test(b.button)){if(c=="mousewheel"){this[e](a,b,b.wheelDelta)}else{this[e](a,b,b.offsetX,b.offsetY,b.screenX,b.screenY)}}}else if(_7.test(c)){this[e](a,b,b.keyCode,b.shiftKey,b.ctrlKey,b.altKey,b.metaKey)}else{this[e](a,b)}}},getComputedStyle:function(a,b){var c=document.defaultView;if(b)return ViewCSS.getComputedPropertyValue(c,a,b);return ViewCSS.getComputedStyle(c,a,null)},getCSSProperty:function(a,b){CSSStyleDeclaration.getPropertyValue(a.style,b)},setCSSProperty:function(a,b,c,e){CSSStyleDeclaration.setProperty(a.style,b,c,e?"important":"")}});forEach([EventTarget,NodeSelector,Node,Element],function(c){c.forEach(function(a,b){if(!Behavior[b]){Behavior[b]=bind(a,c)}})});ClassList.forEach(function(a,b){Behavior[b+"Class"]=bind(a,ClassList)});var Rule=Base.extend({constructor:function(a,b){if(!instanceOf(a,Selector)){a=new Selector(a)}if(!Behavior.ancestorOf(b)){b=Behavior.extend(b)}this.refresh=function(){a.exec(document).forEach(b.attach)};this.toString=a.toString;DocumentState.addRule(a,b)},refresh:Undefined});var RuleList=Collection.extend({constructor:function(a){this.base(extend({},a))},refresh:function(){this.invoke("refresh")}},{Item:Rule});var EventListener=Base.extend({constructor:function(a){this.delegator=a},delegator:null,add:function(a,b){EventTarget.addEventListener(a,b,this,_6.test(b))},delegate:function(a){this.add(document,a)},handleEvent:function(a){this.delegator.handleEvent(a)},"@MSIE":{handleEvent:function(a){var b=a.target;if(_1.test(a.type)&&!b.currentStyle.hasLayout){a=extend({},a);a.offsetX-=b.offsetLeft;a.offsetY-=b.offsetTop}this.delegator.handleEvent(a)}},"@Gecko":{handleEvent:function(a){if(_1.test(a.type)){var b=document.getBoxObjectFor(a.target);a.offsetX=a.pageX-b.x;a.offsetY=a.pageY-b.y}this.delegator.handleEvent(a)}}});var EventDelegator=Base.extend({constructor:function(a,b){this.behavior=a;this.attached=b},behavior:null,attached:null,handleEvent:function(a){var b=a.type;var c=this.behavior;if(b=="documentready"){if(c._0){forEach(c._0,bind(c.ondocumentready,c));delete c._0}}else{var e=a.target;if(e&&this.attached[e.base2ID]){c.handleEvent(e,a,b)}}}});var ExtendedMouse=Behavior.extend(null,{handleEvent:function(a,b,c){c=b.type;if(_3.test(c)){var e=this["on"+c];if(e){this[e](a,b,b.button,b.offsetX,b.offsetY,b.screenX,b.screenY)}}else{this.base(a,b)}}});var DocumentState=Behavior.extend({onDOMContentLoaded:function(){this.loaded=true},onkeydown:function(){this.active=this.busy=true},onkeyup:function(){this.active=this.busy=false},onmousedown:function(a,b,c){this.active=this.busy=(b>=0&&b<a.offsetWidth&&c>=0&&c<a.offsetHeight)},onmouseup:function(){this.active=this.busy=false},onmousemove:function(){if(!this.busy)this.setBusyState(true)}},{EventDelegator:{handleEvent:function(a){this.behavior["on"+a.type](a.target,a.offsetX,a.offsetY)}},active:false,busy:false,loaded:false,ready:false,readyQueue:[],rules:new Array2,init:function(){this.attach(document)},addRule:function(a,b){assert(!/:/.test(a),format("Pseudo class selectors not allowed in JSB (selector='%2').",a));var c=Selector.parse(a);this.rules.push({query:c,behavior:b});if(this.rules.length==1)this.recalc()},isContentReady:function(a){if(this.loaded||!a.canHaveChildren)return true;while(a&&!a.nextSibling){a=a.parentNode}return!!a},recalc:function(a,b,c){var e=this.rules;if(!this.busy){var l=this.readyQueue;var f=Date2.now(),d=f,g=0;while(l.length&&(f-d<_2)){var i=l[0];if(this.isContentReady(i.element)){i.behavior.oncontentready(i.element);l.shift()}if(g++<5||g%50==0)f=Date2.now()}var m=e.length;while(m&&e.length&&(f-d<_2)){if(a==null)a=b=0;var h=e[a];var j=h.behavior;var k=false;if(!c){var n=h.query;var o=n.state||[];o.unshift(document,_8);c=n.apply(null,o);k=n.complete}f=Date2.now();var p=c.length,g=0;while(b<p&&(f-d<_2)){j.attach(c[b++]);if(g++<5||g%50==0)f=Date2.now()}if(b==p){b=0;c=null;if(this.loaded&&k){e.removeAt(a)}else a++}if(a>e.length-1)a=0;m--}}if(e.length){setTimeout(bind(this.recalc,this,a,b,c),_a)}else{if(!this.ready)this.fireReady(document)}},fireReady:function(){if(!this.ready){this.ready=true;this.dispatchEvent(document,"documentready")}},setBusyState:function(a){this.busy=this.active||!!a;if(this.busy)setTimeout(bind(this.setBusyState,this),250)}});eval(this.exports)};