/*
  base2 - copyright 2007-2008, Dean Edwards
  http://code.google.com/p/base2/
  http://www.opensource.org/licenses/mit-license.php

  Contributors:
    Doeke Zanstra
*/
new function(_t){var chrome=new base2.Package(this,{parent:base2.JSB,name:"chrome",version:"0.2",imports:"Enumerable,Function2,DOM,JSB",exports:"Chrome,ComboBox,Range,ProgressBar,Slider,Spinner,Rect",host:"http://base2.googlecode.com/svn/trunk/src/base2/JSB/chrome/"});eval(this.imports);if(detect("MSIE6")){try{document.execCommand("BackgroundImageCache",false,true)}catch(ex){}}var _u=detect("MSIE");var PX="px";var _f="\x5factive",_o="\x5fhover",_h="\x5ffocus",_b="\x5ftimer";var _3={},_5={},_6={};function _p(){this.scrollTop=0};var _7="clientWidth";var _8="clientHeight";var Theme=Base.extend({constructor:function(a){this.load(a)},name:"default",createStyleSheet:function(a){if(document.body){var b=document.createElement("style");b.type="text/css";b.textContent=a;new Selector("head").exec(document,1).appendChild(b)}else{document.write(format('<style type="text/css">%1<\/style>',a))}},load:function(a){if(a)this.name=a;this.createStyleSheet(format(css,this))},toString:function(){return chrome.host+this.name+"/"},"@MSIE":{createStyleSheet:function(a){document.createStyleSheet().cssText=a}}},{detect:K("default"),"@Windows":{detect:function(){var a=document.createElement("input");var b=NodeSelector.querySelector(document,"body,head");b.appendChild(a);a.style.color="ActiveCaption";var c=a.style.color;if(!_i[c]){c=ViewCSS.getComputedPropertyValue(document.defaultView,a,"color");if(/rgb/.test(c))c=eval(c)}b.removeChild(a);return _i[c]},"@MSIE6":{detect:function(){return this.base()||{"#ece9d8":"luna/blue","#e0dfe3":"luna/silver","#ebe9ed":"royale"}[document.documentElement.currentStyle.scrollbarFaceColor]||"classic"}},"@MSIE5":{detect:K("classic")}},"@Safari|Camino":{detect:K("aqua")}});var _i={"#0a246a":"classic","#0054e3":"luna/blue","#8ba169":"luna/olive","#c0c0c0":"luna/silver","#335ea8":"royale"};chrome.theme=Theme.detect();base2.userAgent+=";theme="+chrome.theme;var rgba=rgb;function rgb(b,c,d){function e(a){return(a<16?"0":"")+a.toString(16)};return"#"+e(b)+e(c)+e(d)};var _q=extend({},{padding:"1px 2px 2px 1px",borderWidth:"2px 1px 1px 2px",borderStyle:"solid",borderColor:"#444 #ddd #ddd #444",backgroundPosition:"9999px 9999px",backgroundAttachment:"scroll!important",backgroundRepeat:"no-repeat!important","@MSIE.+theme=classic":{padding:"1px",borderWidth:"2px",borderStyle:"inset",borderColor:"#fff"},"@Gecko.+theme=classic":{padding:"1px",borderWidth:"2px",MozBorderTopColors:"ThreeDShadow ThreeDDarkShadow",MozBorderRightColors:"ThreeDHighlight ThreeDLightShadow",MozBorderLeftColors:"ThreeDShadow ThreeDDarkShadow",MozBorderBottomColors:"ThreeDHighlight ThreeDLightShadow"},"@theme=aqua":{padding:"1px 2px 2px 2px",borderWidth:"2px 1px 1px 1px",borderColor:"#9e9e9e #b4b4b4 #dadada #b4b4b4"},"@theme=(luna|royale)":{padding:"2px",borderWidth:"1px",borderStyle:"solid",borderColor:"#a7a6aa","@luna\\/blue":{borderColor:"#7f9db9"},"@luna\\/olive":{borderColor:"#a4b97f"},"@luna\\/silver":{borderColor:"#a5acb2"}}});function _r(){return" {\n"+map(this,function(b,c){if(typeof b=="function")b="none";return"  "+c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})+": "+b}).join(";\n")+"\n}"};var css={toString:function(){return map(this,function(a,b){return b+a}).join("\n")}};var styleSheet={combobox:{paddingRight:"19px!important",backgroundImage:"url(%1menulist.png)!important",width:"8em","@Safari.+theme=aqua":{WebkitAppearance:"menulist!important",background:"initial",border:"initial"}},"progressbar,slider":{textIndent:"-10em",cursor:"default",WebkitUserSelect:"none","@MSIE":{textIndent:0,lineHeight:"80em"}},progressbar:{padding:"1px",border:"2px solid ThreeDDarkShadow",WebkitBorderRadius:"2px",MozBorderRadius:"2px",MozBorderTopColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderRightColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderLeftColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderBottomColors:"ThreeDDarkShadow ThreeDHighlight",backgroundImage:"url(%1progressbar.png)!important"},slider:{minHeight:"16px",padding:"3px",border:0,backgroundColor:"transparent",backgroundImage:"url(%1slider.png)!important","@Safari.+theme=aqua":{outline:"none!important"},"@Gecko":{MozBorder:"initial"},"@Gecko(1|200[0-2])":{backgroundColor:"#f2f2f2"}},"progressbar_focus,slider_focus":{background:"initial",padding:"initial",border:"initial",outline:"1px dotted",MozOutline:"1px dotted"},datalist:{display:"none!important"},popup:{display:"none",borderWidth:"1px",position:"absolute!important",zIndex:"999999!important",cursor:"default!important",padding:"0!important",margin:"0!important","!@theme=(luna|royale)":{borderColor:"red"},"@Gecko|opera|theme=aqua":{MozBorder:"initial",borderColor:"black",borderStyle:"outset!important"}},spinner:{textAlign:"right",width:"5em",paddingRight:"19px!important",backgroundImage:"url(%1spinner.png)!important"},"@WebKit|opera":{"input[type=range]":{background:"initial",height:"initial",padding:"initial",border:"initial"}}};forEach.detect(styleSheet,function(e,f){if(/,/.test(f)){forEach.csv(f,partial(arguments.callee,e))}else{if(/^[\w-]+$/.test(f)){f="."+f}var g=css[f];if(!g)g=css[f]=extend({toString:_r},_q);forEach.detect(e,function(c,d){if(c=="initial"){forEach(g,function(a,b){if(b.indexOf(d)==0){delete g[b]}});delete g[d]}else{g[d]=c}})}});new Theme(chrome.theme);var Chrome=Behavior.modify({HORIZONTAL:0,VERTICAL:1,states:{normal:0,hover:1,active:2,disabled:3,length:4},appearance:"",imageWidth:17,oncontentready:function(a){if(a[_8]>a[_7]){this.setOrientation(a,this.VERTICAL)}this.layout(a,this.states[a.disabled?"disabled":"normal"])},onclick:function(a,b,c,d){},ondblclick:function(a,b,c,d){},onmousedown:function(a,b,c,d){Chrome._c=a;if(!this.isEditable(a))return;Chrome._0=this.hitTest(a,c,d);if(Chrome._0){this.setCapture(a)}this.layout(a)},onmouseup:function(a,b){delete Chrome._c;if(Chrome._0){delete Chrome._0;this.layout(a)}this.releaseCapture(a)},onmousemove:function(a,b,c,d){var e=this.hitTest(a,c,d);if(e!=Chrome._2){Chrome._2=e;this.layout(a)}},onmouseover:function(a,b,c,d){Chrome._9=a;Chrome._2=this.hitTest(a,c,d);this.layout(a)},onmouseout:function(a){delete Chrome._0;delete Chrome._2;delete Chrome._9;this.layout(a)},onfocus:function(a){Chrome._d=a;this.layout(a)},onblur:function(a){delete Chrome._d;this.removeClass(a,this.appearance+_h);this.layout(a)},isActive:function(a){return Chrome._0&&(Chrome._0==Chrome._2)},isEditable:function(a){return!a.disabled&&!a.readOnly},isNativeControl:False,getCursor:function(a){return(Chrome._0||Chrome._2||a!=Chrome._9)?"default":""},syncCursor:function(a){a.style.cursor=this.getCursor(a)},getState:K(0),hitTest:function(a,b){var c=false;return c?b<=this.imageWidth:b>=a[_7]-this.imageWidth},setOrientation:function(a,b){if(b==this.VERTICAL){_6[a.base2ID]=true;this.setCSSProperty(a,"background-image","url("+chrome.host+chrome.theme+"/"+this.appearance+"-vertical.png)",true)}else{delete _6[a.base2ID];a.style.backgroundImage=""}},hasTimer:function(a,b){b=a.base2ID+(b||_b);return!!_3[b]},startTimer:function(a,b,c){b=a.base2ID+(b||_b);if(!_3[b]){_3[b]=this.setInterval(this.tick,100,a)}},stopTimer:function(a,b){b=a.base2ID+(b||_b);if(_3[b]){clearInterval(_3[b]);delete _3[b]}},tick:Undefined,layout:function(a,b){if(b==null)b=this.getState(a);var c=a[_7],d=a[_8];var e=-this.states.length*(d/2*(d-1));e-=d*b;a.style.backgroundPosition=(c-this.imageWidth)+PX+" "+e+PX;this.syncCursor(a)}});var ComboBox=Chrome.modify({appearance:"menulist",onmousedown:function(a,b,c){base(this,arguments);if(this.isEditable(a)){if(!Chrome._1){Chrome._1=this.createPopup()}if(Chrome._1){if(this.hitTest(a,c)){if(Chrome._1.isOpen){Chrome._1.hide()}else{Chrome._1.show(a)}}}}},onkeydown:function(a,b,c){if(this.isEditable(a)){var d=c==38||c==40;if(!Chrome._1&&d){Chrome._1=this.createPopup()}if(Chrome._1){if(c==27){Chrome._1.hide()}else if(d&&!Chrome._1.isOpen){Chrome._1.show(a);b.preventDefault()}else if(Chrome._1.isOpen){Chrome._1.onkeydown();b.preventDefault()}return}}},onkeyup:function(a){if(this.isActive(a))Chrome._1.onkeyup()},"@MSIE":{onfocus:function(b){base(this,arguments);b.attachEvent("onpropertychange",c);b.attachEvent("onblur",function(){b.detachEvent("onpropertychange",c);b.detachEvent("onblur",arguments.callee)});function c(a){if(a.propertyName=="value"){b.scrollLeft=9999}}}},"@Safari.+theme=aqua":{layout:function(a){this.syncCursor(a)}},createPopup:function(){return new Popup(this)},isActive:function(a){return Chrome._1&&Chrome._1.isOpen},getState:function(a){if(a.disabled){var b="disabled"}else if(a.readOnly){b="normal"}else if(a==Chrome._c&&Chrome._0){b="active"}else if(a==Chrome._9&&Chrome._2){b="hover"}else{b="normal"}return this.states[b]}});var Range=Chrome.modify({min:"",max:"",step:1,onattach:function(a){var b=this.getProperties(a);var c=a.value,d=b.min;if(!c||isNaN(c))c=d;_5[a.base2ID]=(c-d)/(b.max-d);a.onscroll=_p},onmousewheel:function(a,b,c){if(this.isEditable(a)&&Chrome._d==a){this.increment(a,-parseInt(c/40));b.preventDefault()}},getProperties:function(a){var b={min:this.min,max:this.max,step:this.step};for(var c in b){var d=a[c];if(d==null&&a.hasAttribute&&a.hasAttribute(c)){d=a.getAttribute(c)}if(d&&!isNaN(d)){b[c]=d}}return b},increment:function(a,b,c){var d=c?"Block":"Unit";b*=this["get"+d+"Increment"](a);this.setValue(a,this.getValue(a)+b)},getBlockIncrement:function(a){return this.getUnitIncrement(a)*10},getUnitIncrement:function(a){return this.getProperty(a,"step")||1},getValue:function(a){return parseFloat(a.value)},setValue:function(a,b){var c=this.getProperties(a);if(isNaN(b))b=0;var d=parseFloat(c.min),e=parseFloat(c.max),f=parseFloat(c.step)||1;b=b>e?e:b<d?d:b;b=Math.round(b/f)*f;b=b.toFixed(String(f).replace(/^.*\.|^\d+$/,"").length);if(b!=a.value){a.value=b;this.dispatchEvent(a,"change")}}});var ProgressBar=Range.modify({HEIGHT:3000,WIDTH:3000,CHUNK_WIDTH:10,CHUNK_HEIGHT:10,min:0,max:100,step:1,appearance:"progressbar","@!theme=aqua":{onfocus:function(a){if(a!=Chrome._c){this.addClass(a,this.appearance+_h)}this.base(a)}},onkeydown:function(a,b,c){if(!this.isEditable(a))return;if(c<33||c>40)return;var d=1;switch(c){case 35:var e=1;case 36:this.setValue(a,e||0);return;case 33:var f=true;break;case 34:f=true;case 37:case 40:d=-1}this.increment(a,d,f)},hitTest:False,getBlockIncrement:function(a){var b=this.getUnitIncrement(a);return Math.max(2*b,Math.round(0.1/b)*b)},getUnitIncrement:function(a){var b=this.getProperties(a);return b.step/(b.max-b.min)||this.base(a)},layout:function(a){var b=a[_7],c=a[_8],d=a.base2ID;if(_6[d]){var e=(-b/2)*(b+3)-2;var f=Math.floor(c*_5[d]);f=c-Math.round(f/this.CHUNK_HEIGHT)*this.CHUNK_HEIGHT}else{var g=/luna/.test(chrome.theme)?this.CHUNK_WIDTH:1;e=Math.floor(b*_5[d])-this.WIDTH;e=Math.round(++e/g)*g;f=(-c/2)*(c+3)-2}a.style.backgroundPosition=e+PX+" "+f+PX},getCursor:K(""),getValue:function(a){return _5[a.base2ID]},setValue:function(a,b){var c=this.getProperties(a);var d=Number(c.min),e=Number(c.max);this.base(a,d+(e-d)*b);_5[a.base2ID]=(a.value-d)/(e-d);this.layout(a)}});var Slider=ProgressBar.modify({HORIZONTAL_WIDTH:3000,HORIZONTAL_HEIGHT:21,VERTICAL_WIDTH:22,VERTICAL_HEIGHT:3000,THUMB_WIDTH:11,THUMB_HEIGHT:11,appearance:"slider",onmousedown:function(a,b,c,d,e,f){base(this,arguments);b.preventDefault();if(!this.isEditable(a))return;if(Chrome._0){var g=this.getThumbRect(a);Chrome._e={dx:e-g.left,dy:f-g.top};Chrome._a=true}else{this.startTimer(a);Chrome._j=c;Chrome._k=d}a.focus()},onmouseup:function(a,b){this.base(a,b);delete Chrome._e;if(!Chrome._a)this.tick(a);this.stopTimer(a);delete Chrome._j;delete Chrome._k;delete Chrome._4;delete Chrome._a},onmousemove:function(a,b,c,d,e,f){if(Chrome._e){var g=a[_7];var i=a[_8];if(g>=i){var h=g-this.THUMB_WIDTH;var j=e-Chrome._e.dx}else{h=i-this.THUMB_HEIGHT;j=h-f+Chrome._e.dy}this.setValue(a,j/h)}else{base(this,arguments)}},layout:function(a,b){if(b==null)b=this.getState(a);var c=this.getThumbRect(a);if(_6[a.base2ID]){var d=c.left;var e=c.top-Math.ceil((this.VERTICAL_HEIGHT-this.THUMB_HEIGHT)/2)-b*this.VERTICAL_HEIGHT}else{d=c.left-Math.ceil((this.HORIZONTAL_WIDTH-this.THUMB_WIDTH)/2)-b*this.HORIZONTAL_WIDTH;e=c.top}a.style.backgroundPosition=d+PX+" "+e+PX},getThumbRect:function(a){var b=a[_7],c=a[_8],d=_5[a.base2ID];if(_6[a.base2ID]){return new Rect((b-this.VERTICAL_WIDTH)/2,(c-=this.THUMB_HEIGHT)-Math.floor(c*d),this.VERTICAL_WIDTH,this.THUMB_HEIGHT)}else{return new Rect(Math.floor((b-this.THUMB_WIDTH)*d),Math.floor((c-this.HORIZONTAL_HEIGHT)/2),this.THUMB_WIDTH,this.HORIZONTAL_HEIGHT)}},hitTest:function(a,b,c){if(a.disabled||this.isNativeControl(a))return null;return this.getThumbRect(a).contains(b,c)},getState:function(a){if(a.disabled){var b="disabled"}else if(a==Chrome._c&&Chrome._0){b="active"}else if(a==Chrome._d||(a==Chrome._9&&Chrome._2)){b="hover"}else{b="normal"}return this.states[b]},tick:function(a){var b=this.getThumbRect(a);if(_6[a.base2ID]){var c=Chrome._k;if(c<b.top&&false!=Chrome._4){this.increment(a,1,true);Chrome._4=true}else if(c>b.top+this.THUMB_HEIGHT&&true!=Chrome._4){this.increment(a,-1,true);Chrome._4=false}}else{var d=Chrome._j;if(d<b.left&&true!=Chrome._4){this.increment(a,-1,true);Chrome._4=false}else if(d>b.left+this.THUMB_WIDTH&&false!=Chrome._4){this.increment(a,1,true);Chrome._4=true}}Chrome._a=true},"@KHTML|opera[91]":{isNativeControl:function(a){return a.nodeName=="INPUT"&&a.type=="range"}},"@theme=aqua":{onblur:function(a){if(a==Slider._g){delete Slider._g}base(this,arguments)},onmousedown:function(a){Slider._g=a;base(this,arguments)},getState:function(a){if(a.disabled){var b="disabled"}else if(a==Chrome._c&&Chrome._0){b="active"}else if(a==Chrome._d&&a!=Slider._g){b="hover"}else{b="normal"}return this.states[b]},startTimer:function(a){}}});var Spinner=Range.modify({appearance:"spinner",states:{normal:0,up_hover:1,up_active:2,down_hover:3,down_active:4,disabled:5,length:6},onkeydown:function(a,b,c){if(!this.isEditable(a))return;if(!/^(3[34568]|40)$/.test(c))return;b.preventDefault();switch(c){case 35:if(a.max)this.setValue(a,a.max);return;case 36:if(a.min)this.setValue(a,a.min);return;case 34:var d=true;break;case 33:d=true;case 38:var e="up"}this.activate(a,e||"down",d)},onkeyup:function(a,b,c){if(!this.isEditable(a))return;this.stopTimer(a);switch(c){case 33:case 34:case 38:case 40:b.preventDefault();this.deactivate(a);break}},onmousedown:function(a){base(this,arguments);if(Chrome._0){this.startTimer(a)}},onmouseup:function(a,b){this.stopTimer(a);this.base(a,b)},"@opera[91]":{isNativeControl:function(a){return a.nodeName=="INPUT"&&a.type=="number"}},activate:function(a,b,c){Chrome._0=Chrome._2=b;this.layout(a);Chrome._l=c;this.startTimer(a,_f)},deactivate:function(a){this.stopTimer(a,_f);delete Chrome._0;delete Chrome._2;delete Chrome._l;this.layout(a)},getState:function(a){if(a.disabled){var b="disabled"}else if(a.readOnly){b="normal"}else if((a==Chrome._9||a==Chrome._d)&&Chrome._0){b=Chrome._0+_f}else if(a==Chrome._9&&Chrome._2){b=Chrome._2+_o}else{b="normal"}return this.states[b]},hitTest:function(a,b,c){if(!this.base(a,b))return null;return c<=(a[_8]/2)?"up":"down"},startTimer:function(a){if(!_3[a.base2ID+_b]){Chrome._s=(Chrome._0=="up")?1:-1;Chrome._m=1;this.base(a)}},stopTimer:function(a){if(_3[a.base2ID+_b]){this.base(a);if(!Chrome._a)this.increment(a);delete Chrome._a;try{a.select()}catch(ex){}}},tick:function(a){this.increment(a);Chrome._m*=1.1},increment:function(a,b,c){if(b==undefined){b=parseInt(Chrome._m*Chrome._s);c=!!Chrome._l}this.base(a,b,c);Chrome._a=true}});var _n="left:%1px!important;top:%2px!important;width:%3px!important;";var Popup=Base.extend({constructor:function(a){this.owner=a;var b=this.popup=document.createElement("div");b.className=this.appearance;b.innerHTML=this.html},appearance:"popup",isOpen:false,inherit:String2.csv("backgroundColor,color,fontFamily,fontSize,fontWeight,fontStyle"),html:"<div>1 thousand</div><div>2 thousand</div><div>3 thousand</div><div>4 thousand</div><div>5 thousand</div>",onkeydown:Undefined,onkeyup:Undefined,hide:function(){this.popup.parentNode.removeChild(this.popup);this.isOpen=false},movesize:function(a){this.popup.style.cssText=format(_n,a.offsetLeft,a.offsetTop+a.offsetHeight,a.offsetWidth-2);a.offsetParent.appendChild(this.popup)},show:function(b){this.isOpen=true;this.movesize(b);var c=this.popup.style;var d=Behavior.getComputedStyle(b);forEach(this.inherit,function(a){c[a]=d[a]});if(c.backgroundColor=="transparent"){c.backgroundColor="Window"}c.display="block"},"@MSIE":{movesize:function(a){var b=document.compatMode!="CSS1Compat"?document.body:document.documentElement;var c=a.getBoundingClientRect();this.popup.style.cssText=format(_n,b.scrollLeft+c.left-2,b.scrollTop+c.bottom-2,a.offsetWidth-2);document.body.appendChild(this.popup)}}});var Rect=Base.extend({constructor:function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d;this.right=a+c;this.bottom=b+d},contains:function(a,b){with(this)return a>=left&&a<=right&&b>=top&&b<=bottom},toString:function(){with(this)return[left,top,width,height].join(",")}});chrome.rules=new RuleList({"input.combobox":ComboBox,"input.progressbar":ProgressBar,"input.slider":Slider,"input.spinner":Spinner});eval(this.exports)};