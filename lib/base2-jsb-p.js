/*
  base2 - copyright 2007-2009, Dean Edwards
  http://code.google.com/p/base2/
  http://www.opensource.org/licenses/mit-license.php

  Contributors:
    Doeke Zanstra
*/
new function(_t){base2.global.jsb=new base2.Package(this,{name:"jsb",version:"0.9.5",imports:"Function2,Enumerable,DOM",exports:"Rule,RuleList,behavior",INTERVAL:1,TIMEOUT:200,QUERY_SIZE:200,createStyleSheet:function(a,b){if(b.body){var c=b.createElement("style");c.type="text/css";c.textContent=a;new Selector("head").exec(b,1).appendChild(c)}else{b.write(format('<style type="text/css">%1<\/style>',a))}},"@MSIE":{createStyleSheet:function(a,b){b.createStyleSheet().cssText=a}}});eval(this.imports);var _b=/^on([a-z|DOM\w+]+)$/,_j=/^mouse(up|down)|click$/,_u=/click$/,_c=/^mouse|click$/,_d=/^mouse(over|out)$/,_k=/^(attach|detach|(content|document)ready)$/,_l=/^(key|text)/,_m=/^(focus|blur)$/;var _n=/^(abort|error|load|scroll|(readystate|property|filter)change)$/,_o=/^(HTML|BODY)$/,_p=/^[^12]$/;var _8=/\d+/g;var _4={};var _q=partial(parseInt,undefined,16);function _e(a){var b=document.createElement(a||"span");b.style.cssText="position:absolute;left:0;top:-9999px;";document.body.appendChild(b);return b};function _6(a,b){if(a==null)return[];a=trim(a).split(/\s+/);if(b){if(a.length==1)a[1]=a[0];if(a.length==2)a[2]=a[0];if(a.length==3)a[3]=a[1]}return a};var _f=Base.extend({attach:I,detach:I,modify:Null,extendedMouse:false,ancestorOf:function(a){return a instanceof this.constructor},extend:function(e){var h=function(){};h.prototype=new this.constructor;h.prototype.constructor=h;var k=e["implements"]||[];delete e["implements"];k.push(e);for(var g=0;e=k[g];g++){extend(h.prototype,e)}var f=new h;var j={behavior:f},n={},p={},o=[],l=null,m,r={handleEvent:function(a){_9(f,a.target,a)}};h.modifications=n;for(var q in f){if(typeof f[q]=="function"&&_b.test(q)){var m=q.slice(2);if(_n.test(m)){if(!l)l=[];l.push(m)}else if(!_k.test(m)){o.push(m)}}}f.attach=function(a){var b=a.uniqueID||assignID(a,"uniqueID");if(!j[b]){j[b]=true;if(!_4[b])_4[b]=0;_4[b]++;if(o){for(var c=0;m=o[c];c++){_r.addEventListener(m,j)}o=null}if(l){for(var c=0;m=l[c];c++){EventTarget.addEventListener(a,m,r,false)}}if(f.onattach){_5(f,a,"attach")}if(f.oncontentready){if(_0.isContentReady(a)){_5(f,a,"contentready")}else{_0.contentReadyQueue.push({behavior:f,element:a})}}if(f.ondocumentready){if(_0.ready){_5(f,a,"documentready")}else{_0.documentReadyQueue.push({behavior:f,element:a})}}if(f.onfocus&&a==document.activeElement){f.dispatchEvent(a,"focus")}}};f.detach=function(a){var b=a.uniqueID;if(j[b]){delete j[b];_4[b]--;if(l){for(var c=0;m=l[c];c++){EventTarget.removeEventListener(a,m,r,false)}}}};f.modify=function(d){d=extend(pcopy(f),d);return{isModification:true,attach:function(a,b){f.attach(a);var c=a.uniqueID;if(b.specificity>=(p[c]||0)){p[c]=b.specificity;n[c]=d}return a}}};return f},animate:function(p,o){var l;forEach(o,function(d,e){var h=arguments.callee;if(typeof d=="string"){d={end:d}}if(!l)l=d;d=copy(d);if(d.delay==null&&l.delay!=null){d.delay=l.delay}if(d.duration==null&&l.duration!=null){d.duration=l.duration}if(/^(font|background(Position)?)$/.test(e)){throw"Cannot animate complex property '"+e+"'.";}else if(/^border(Top|Right|Bottom|Left)?$/.test(e)){var k=e,g=_6(d.start),f=_6(d.end),j=["Width","Style","Color"];forEach(f,function(a,b){var c=copy(d);c.start=g[b];c.end=a;h(c,k+j[b])})}else if(/^(margin|padding|border(Width|Color|Style))$/.test(e)){var k=e.replace(/Width|Color|Style/,""),n=e.replace(k,"");g=_6(d.start,true);f=_6(d.end,true);forEach.csv("Top,Right,Bottom,Left",function(a,b){var c=copy(d);c.start=g[b];c.end=f[b];_0.transitions.add(p,k+a+n,c)})}else{_0.transitions.add(p,e,d)}})},get:function(a,b){var c=this.constructor.modifications[a.uniqueID]||this,d=c[b],e=Element.getAttribute(a,b);if(e==null)return d;switch(typeof d){case"boolean":return true;case"number":return e-0}return e},set:function(a,b,c){var d=this.get(a,b);Element.setAttribute(a,b,c);if(d!==c){this.dispatchEvent(a,b+"change",{originalValue:d})}},dispatchEvent:function(a,b,c){if(typeof b=="string"){var d=b;b=DocumentEvent.createEvent(document,"Events");var e=true,h=false;if(c){if(c.bubbles!=null)e=!!c.bubbles;if(c.cancelable!=null)h=!!c.cancelable;delete c.bubbles;delete c.cancelable}Event.initEvent(b,d,e,h)}if(c)extend(b,c);EventTarget.dispatchEvent(a,b)},getComputedStyle:function(a,b){var c=document.defaultView;if(arguments.length==1){return ViewCSS.getComputedStyle(c,a,null)}else{return ViewCSS.getComputedPropertyValue(c,a,b)}},setStyle:function(a,b,c,d){var e=a.style;if(arguments.length==2){var h=extend({},arguments[1]);for(b in h){CSSStyleDeclaration.setProperty(e,b,h[b],"")}}else{CSSStyleDeclaration.setProperty(e,b,c,d?"important":"")}},getOffsetFromBody:function(a){return ElementView.getOffsetFromBody(a)},captureMouse:function(a){if(!_0.captureElement)_0.captureElement=a},releaseMouse:function(){delete _0.captureElement}});var behavior=_f.prototype;forEach.csv("setInterval,setTimeout",function(e){behavior[e]=function(a,b){if(typeof a=="string")a=this[a];var c=Array2.slice(arguments,2);var d=this;return global[e](function(){a.apply(d,c)},b||1)}});forEach.csv("querySelector,querySelectorAll",function(c){behavior[c]=function(a,b){if(arguments.length==1){b=a;a=document}return NodeSelector[c](a,b)}});forEach([EventTarget,ElementView,Node,Element],function(c){c.forEach(function(a,b){if(!behavior[b]){behavior[b]=bind(a,c)}})});ClassList.forEach(function(a,b){behavior[b+"Class"]=bind(a,ClassList)});behavior=new _f;var Rule=Base.extend({constructor:function(b,c){if(!instanceOf(b,Selector)){b=new Selector(b)}if(typeof c=="string"){c=new External(c,function(a){c=a})}else if(!c.isModification&&!jsb.behavior.ancestorOf(c)){c=jsb.behavior.extend(c)}this.refresh=function(){if(c.attach)b.exec(document).forEach(c.attach)};this.toString=b.toString;forEach(b.split(),function(a){_0.addRule(a,c)})},refresh:Undefined});var RuleList=Collection.extend({constructor:function(a){this.base(extend({},a))},refresh:function(){this.invoke("refresh")}},{Item:Rule});var Transition=Base.extend({constructor:function(d,e,h){extend(this,h);this.toString=K(d.uniqueID+"."+e);this.property=e;var k=d.style,g=this.start,f=this.timing;if(g==null){g=this.start=k[e]||ViewCSS.getComputedPropertyValue(document.defaultView,d,e)||""}if(/color$/i.test(e)){g=this.parseColor(g);var j=this.parseColor(this.end),n=map(g,function(a,b){return j[b]-a}),p=function(c){return"rgb("+map(g,function(a,b){return Math.round(f(c,a,n[b],s))}).join(", ")+")"}}else if(e=="clip"){g=map(match(g,_8),Number);j=map(match(this.end,_8),Number);n=map(g,function(a,b){return j[b]-a});p=function(c){return"rect("+map(g,function(a,b){return Math.round(f(c,a,n[b],s))}).join("px, ")+"px)"}}else if(/\d/.test(this.end)){var o=String(this.end).replace(/^[-.\d]+/,"").toLowerCase();if(parseInt(g)==0)g=this.start=0+o;g=Number(String(g).replace(o,""));j=Number(String(this.end).replace(o,""));n=j-g;p=function(a){var b=f(a,g,n,s);if(o=="px")b=Math.round(b);return b+o}}else{j=this.end||"";p=function(a){return f(a,0,1,s)<0.5?g:j}}var l=Date2.now(),m=this.compare(this.start,"end"),r=false,q=0,u=0,w=this.delay*1000,s=this.duration*1000,v=1,t=0;if(typeof f!="function"){f=Transition.timingFunctions[f]}assertType(f,"function","Invalid timing function.");this.tick=function(a){if(!m&&!u){t=a-l;if(!q&&t>=w){q=a}if(q){t=Math.min((a-q)*v,s);m=t>=s;var b=r?s-t:t;CSSStyleDeclaration.setProperty(k,e,p(b),"");if(m){behavior.dispatchEvent(d,"transitionend",{propertyName:e,elapsedTime:(a-l)/1000})}}}return!m};this.flip=function(){var a=this.start;this.start=this.end;this.end=a;r=!r;if(q){q=Date2.now()-(s-t)/v}};this.setSpeed=function(a){if(q){v=a;q=Date2.now()-t/v}}},delay:0,duration:1,timing:"ease",compare:function(a,b){if(/color$/i.test(this.property)){return this.parseColor(this[b]).join(",")==this.parseColor(a).join(",")}else if(this.property=="clip"){return this[b].replace(/,\s*/g," ")==a.replace(/,\s*/g," ")}return this[b]==a},parseColor:function(a){var b=Transition.colors;if(!b[a]){if(/^rgb/.test(a)){b[a]=map(a.match(_8),Number)}else if(a.indexOf("#")==0){var c=a.slice(1);if(c.length==3)c=c.replace(/([0-9a-f])/g,"$1$1");b[a]=map(c.match(/([0-9a-f]{2})/g),_q)}else{var d=Transition._s;if(d){document.body.appendChild(d)}else{d=Transition._s=_e("input")}try{d.style.color=a;var e=ViewCSS.getComputedPropertyValue(document.defaultView,d,"color")}catch(x){}document.body.removeChild(d);if(e!=a){b[a]=this.parseColor(e||"#000")}}}var h=b[a];if(!h||h.length!=3||Array2.contains(h,NaN)){throw"Invalid color '"+a+"'.";}return h}},{timingFunctions:{"ease":function(a,b,c,d){if((a/=d/2)<1){return c/2*a*a*a*a+b}return-c/2*((a-=2)*a*a*a-2)+b},"linear":function(a,b,c,d){return c*a/d+b},"ease-in":function(a,b,c,d){return c*(a/=d)*a+b},"ease-out":function(a,b,c,d){return-c*(a/=d)*(a-2)+b},"ease-in-out":function(a,b,c,d){if((a/=d/2)<1){return c/2*a*a+b}return-c/2*((--a)*(a-2)-1)+b}},colors:{}});var Transitions=Collection.extend({add:function(a,b,c){var d=a.uniqueID+"."+b;var e=this.get(d);if(e){e.setSpeed(e.duration/(c.duration||1));if(e.compare(c.end,"start")){e.flip()}}else{this.put(d,a,b,c);if(!this._g)this.tick()}},tick:function(){var c=Date2.now(),d=[];forEach(this,function(a,b){if(!a.tick(c)){d.push(b)}});forEach(d,this.remove,this);if(this.size()>0){this._g=setTimeout(bind(this.tick,this),1)}else{delete this._g}}},{Item:Transition,create:function(a,b,c,d){return new this.Item(b,c,d)}});extend(jsb,"createStyleSheet",function(g,f){if(!f)f=global.document;if(typeof g!="string"){var j=g;var n={toString:function(){return map(this,function(a,b){return b+a}).join("\n").replace(/!([^\w])/g,"!important$1")}};var p=j["*"]||{};p.toString=function(){return" {\n"+map(this,function(b,c){if(typeof b=="function")b="none";return"  "+c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})+": "+b}).join(";\n")+"\n}"};delete j["*"];var o=/^[A-Z]/;forEach.detect(j,function(e,h){if(/,/.test(h)){forEach(new Selector(h).split(),partial(arguments.callee,e))}else{var k=n[h];if(!k)k=n[h]=extend({toString:p.toString},p);forEach.detect(e,function(c,d){if(/^Webkit/.test(d))arguments.callee(c,"Khtml"+d.slice(6));if(o.test(d)&&d.indexOf(ViewCSS.VENDOR)!=0){arguments.callee(c,d.replace(o,String2.toLowerCase));d=ViewCSS.VENDOR+d}if(c=="initial"){forEach(k,function(a,b){if(b.indexOf(d)==0){delete k[b]}});delete k[d]}k[d]=c})}});g=n.toString()}var l=location.pathname;var m=Array2.item(f.getElementsByTagName("script"),-1);if(m)l=m.src||l;l=l.replace(/[\?#].*$/,"").replace(/[^\/]*$/,"");g=g.replace(/%theme%/g,"themes/"+jsb.theme);var r=/(url\s*\(\s*['"]?)([\w\.]+[^:\)]*['"]?\))/gi;this.base(g.replace(r,"$1"+l+"$2"),f);return g});var External=Base.extend({constructor:function(a,b){a=a.split("#");this.src=a[0];this.id=a[1].split(".");this.register=b},getObject:function(){var a=global,b=0;while(a&&b<this.id.length){a=a[this.id[b++]]}return a},load:function(){var a=this.getObject();if(!a&&!this.script){External.SCRIPT.src=this.src;if(!External.scripts[External.SCRIPT.src]){External.scripts[External.SCRIPT.src]=true;this.script=document.createElement("script");this.script.type="text/javascript";this.script.src=this.src;behavior.querySelector("head").appendChild(this.script)}a=this.getObject()}if(a){this.register(a);this.unload()}return a},unload:function(){if(this.script){this.script.parentNode.removeChild(this.script);this.script=null}}},{SCRIPT:document.createElement("script"),scripts:{}});var _r={types:{},addEventListener:function(a,b){var c=this.types;if(!c[a]){c[a]=[];EventTarget.addEventListener(document,a,this,_m.test(a))}c[a].push(b)},handleEvent:function(a){var b=a.target;if(b.nodeType!=1)return;var c=a.type,d=_c.test(c),e=_0.captureElement&&d;if(e&&_d.test(c))return;var h=this.types[c];if(!h||!h.length)return;if(d&&c!="mousewheel"){if(a.offsetX!=null){a=Event.cloneEvent(a)}var k=ElementView.getOffsetXY(b,a.clientX,a.clientY);a.offsetX=k.x;a.offsetY=k.y}var g=!a.bubbles||e,f=e?_0.captureElement:b;if(!g){extend(a,"stopPropagation",function(){this.base();g=true})}do{if(_4[f.uniqueID]){for(var j=0,n;n=h[j];j++){if(n[f.uniqueID]){_9(n.behavior,f,a)}}}f=f.parentNode}while(f&&!g)}};var _h=detect("MSIE");var _a,_2,_1;if(_h){var _7=document.createElement("meta");_7.jsbEvents=0;_7.attachEvent("onpropertychange",function(a){if(a.propertyName=="jsbEvents"){_2.apply(_a,_1)}});document.getElementsByTagName("head")[0].appendChild(_7)}else{document.addEventListener("jsbEvents",function(){_2.apply(_a,_1)},false)}function _9(a,b,c,d){var e=c.type;_2=a["on"+e];if(!_2||_2==Undefined)return;_a=a;_1=[b,c];if(_c.test(e)){if(e=="mousewheel"){_1.push(c.wheelDelta)}else{if(_j.test(e)){if(a.extendedMouse){_1.push(c.button)}else{if(!_p.test(c.button||0))return}}if(!_d.test(e)){if(b==c.target){var h=c.offsetX,k=c.offsetY}else{var g=ElementView.getOffsetXY(b,c.clientX,c.clientY);h=g.x;k=g.y}_1.push(h,k,c.screenX,c.screenY)}}}else if(_l.test(e)){_1.push(c.keyCode,c.shiftKey,c.ctrlKey,c.altKey,c.metaKey)}if(d||c.bubbles){if(_h){_7.jsbEvents++}else{var f=document.createEvent("UIEvents");f.initEvent("jsbEvents",false,false);document.dispatchEvent(f)}}else{_2.apply(a,_1)}};var _3=Document.createEvent(document,"UIEvents");_3.initEvent("dummy",false,false);_3=Event.cloneEvent(_3);function _5(a,b,c){_3.target=b;_3.type=c;_9(a,b,_3,true)};var _0=new Base({timestamp:Date2.now(),contentReadyQueue:[],documentReadyQueue:[],liveRules:new Array2,rules:new Array2,transitions:new Transitions,onDOMContentLoaded:function(){_0.loaded=true;if(!_0.ready&&!_0.rules.length){setTimeout(_0.fireReady,_0.getInterval())}_0.isContentReady=True},onkeydown:function(){_0.active=_0.busy=true},onkeyup:function(){_0.active=_0.busy=false},onmousedown:function(a){_0.activeElement=a.target;_0.active=_0.busy=true},onmousemove:function(){if(!_0.busy)_0.setBusyState(true)},onmousewheel:function(){if(!_0.busy)_0.setBusyState(true)},onmouseup:function(){_0.activeElement=null;_0.active=_0.busy=false},addRule:function(a,b){if(a.isPseudo()){throw"Pseudo class selectors are not allowed in JSB rules (selector='"+a+"').";}var c={selector:a,query:Selector.parse(a),behavior:b,specificity:a.getSpecificity()};_0.liveRules.push(c);if(!_0.loaded){_0.rules.push(c);_0.rules.unsorted=true}if(!_0.started){_0.started=true;_0.tick()}},getInterval:function(){return _0.busy?Math.sqrt(jsb.INTERVAL)*50:jsb.INTERVAL},fireReady:function(){if(!_0.ready){_0.ready=true;Array2.batch(_0.documentReadyQueue,function(a){_5(a.behavior,a.element,"documentready")},jsb.TIMEOUT,_0.parseComplete);_0.documentReadyQueue=[]}},isContentReady:function(a){if(_o.test(a.nodeName))return false;if(!a.hasChildNodes())return true;while(a&&!a.nextSibling){a=a.parentNode}return!!a},parseComplete:function(){_0.rules=_0.liveRules.copy();_0.rules.sort(_i);_0.tick()},tick:function(a,b,c){var d=Date2.now(),e=_0.rules,h=e.length;if(!_0.busy&&_0.timestamp-d<=jsb.INTERVAL){_0.timestamp=d;var k=_0.contentReadyQueue;var g=Date2.now(),f=g,j=0;while(k.length&&(g-f<jsb.TIMEOUT)){var n=k.shift();if(_0.isContentReady(n.element)){_5(n.behavior,n.element,"contentready")}else{contentReadypush(n)}if(j++<5||j%50==0)g=Date2.now()}while(h&&e.length&&(g-f<jsb.TIMEOUT)){if(a==null)a=b=0;var p=e[a],o=p.behavior;var l=false;if(!c){var m=p.query;var r=m.state||[];r.unshift(document,o.constructor==External?2:jsb.QUERY_SIZE);c=m.apply(null,r);l=!!m.complete}g=Date2.now();var q=c.length,j=0;if(q&&o.constructor==External){p.behavior=o.load()||o;delete m.state;c=null;a++}else{while(b<q&&(g-f<jsb.TIMEOUT)){o.attach(c[b++],p);if(j++<5||j%50==0)g=Date2.now()}if(b==q){b=0;c=null;if(_0.loaded&&l){e.removeAt(a);delete m.state}else a++}}if(a>=e.length){a=0;if(e.unsorted){e.sort(_i);e.unsorted=false}}h--}}if(e.length){var u=function(){_0.tick(a,b,c)}}else{if(_0.ready){u=_0.parseComplete}else{u=_0.fireReady}}setTimeout(u,_0.getInterval())},setBusyState:function(a){a.busy=a.active||!!a;if(a.busy)setTimeout(arguments.callee,250)}});for(var i in _0)if(_b.test(i)){EventTarget.addEventListener(document,i.slice(2),_0[i],i!="onDOMContentLoaded")}function _i(a,b){return b.specificity-a.specificity};EventTarget.addEventListener(window,"load",function(){var c=_e(),d;c.innerHTML="&nbsp;";setTimeout(function(){if(!_0.busy){var a=d!=null&&d!=c.clientHeight;d=c.clientHeight;if(a){var b=Document.createEvent(document,"UIEvents");b.initEvent("textresize",false,false);EventTarget.dispatchEvent(document,b)}}setTimeout(arguments.callee,_0.busy||a?500:100)},100)},false);eval(this.exports)};