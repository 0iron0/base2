new function(_v){var chrome=new base2.Package(this,{parent:base2.JSB,name:"chrome",version:"0.2",imports:"Enumerable,Function2,DOM,JSB",exports:"Chrome,ComboBox,Range,ProgressBar,Slider,Spinner,Rect",host:"http://base2.googlecode.com/svn/trunk/src/base2/JSB/chrome/"});eval(this.imports);var _u=detect("MSIE"),_p=detect("opera");var PX="px";var _e="_7",_o="_6",_g="_9",_c="_w";var _5={},_a={},_b={};function _t(){this.scrollTop=0};var Theme=Base.extend({constructor:function(a){this.load(a)},name:"default",createStyleSheet:function(a){if(document.body){var b=document.createElement("style");b.type="text/css";b.textContent=a;new Selector("head").exec(document,1).appendChild(b)}else{document.write(format('<style type="text/css">%1<\/style>',a))}},load:function(a){if(a)this.name=a;this.createStyleSheet(format(css,this))},toString:function(){return chrome.host+this.name+"/"},"@MSIE":{createStyleSheet:function(a){document.createStyleSheet().cssText=a}}},{detect:K("default"),"@Windows":{detect:function(){var a=document.createElement("input");var b=NodeSelector.querySelector(document,"head");b.appendChild(a);a.style.color="ActiveCaption";var c=a.style.color;if(!_i[c]){c=ViewCSS.getComputedPropertyValue(document.defaultView,a,"color");if(/rgb/.test(c))c=eval(c)}b.removeChild(a);return _i[c]},"@MSIE5":{detect:K("classic")}},"@Safari":{detect:K("aqua")}});var _i={"#0a246a":"classic","#0054e3":"luna/blue","#8ba169":"luna/olive","#c0c0c0":"luna/silver","#335ea8":"royale"};chrome.theme=Theme.detect();base2.userAgent+=";theme="+chrome.theme;var rgba=rgb;function rgb(b,c,d){function e(a){return(a<16?"0":"")+a.toString(16)};return"#"+e(b)+e(c)+e(d)};var _q=extend({},{padding:"1px 2px 2px 1px",borderWidth:"2px 1px 1px 2px",borderStyle:"solid",borderColor:"#444 #ddd #ddd #444",backgroundPosition:"9999px 9999px",backgroundAttachment:"scroll!important",backgroundRepeat:"no-repeat!important","@MSIE.+theme=classic":{padding:"1px",borderWidth:"2px",borderStyle:"inset",borderColor:"#fff"},"@Gecko.+theme=classic":{padding:"1px",borderWidth:"2px",MozBorderTopColors:"ThreeDShadow ThreeDDarkShadow",MozBorderRightColors:"ThreeDHighlight ThreeDLightShadow",MozBorderLeftColors:"ThreeDShadow ThreeDDarkShadow",MozBorderBottomColors:"ThreeDHighlight ThreeDLightShadow"},"@theme=aqua":{padding:"1px 2px 2px 2px",borderWidth:"2px 1px 1px 1px",borderColor:"#9e9e9e #b4b4b4 #dadada #b4b4b4"},"@theme=(luna|royale)":{padding:"2px",borderWidth:"1px",borderStyle:"solid",borderColor:"#a7a6aa","@luna\\/blue":{borderColor:"#7f9db9"},"@luna\\/olive":{borderColor:"#a4b97f"},"@luna\\/silver":{borderColor:"#a5acb2"}}});function _r(){return" {\n"+map(this,function(b,c){if(typeof b=="function")b="none";return"  "+c.replace(/[A-Z]/g,function(a){return"-"+a.toLowerCase()})+": "+b}).join(";\n")+"\n}"};var css={toString:function(){return map(this,function(a,b){return b+a}).join("\n")}};var styleSheet={combobox:{paddingRight:"19px!important",width:"8em",backgroundImage:"url(%1menulist.png)!important","@Safari.+theme=aqua":{WebkitAppearance:"menulist!important",background:"initial",border:"initial",padding:"initial"}},"progressbar,slider":{textIndent:"-10em",cursor:"default",WebkitUserSelect:"none","@MSIE":{textIndent:0,lineHeight:"80em"}},progressbar:{padding:"1px",border:"2px solid ThreeDDarkShadow",WebkitBorderRadius:"2px",MozBorderRadius:"2px",MozBorderTopColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderRightColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderLeftColors:"ThreeDDarkShadow ThreeDHighlight",MozBorderBottomColors:"ThreeDDarkShadow ThreeDHighlight",backgroundImage:"url(%1progressbar.png)!important"},slider:{minHeight:"16px",padding:"3px",border:0,backgroundColor:"transparent",backgroundImage:"url(%1slider.png)!important","@Safari.+theme=aqua":{outline:"none!important"},"@Gecko":{MozBorder:"initial"}},"progressbar_focus,slider_focus":{outline:"none",MozOutline:"1px dotted"},popup:{display:"none",borderWidth:"1px",position:"absolute!important",zIndex:"999999!important",cursor:"default!important",padding:"0!important",margin:"0!important","!@theme=(luna|royale)":{borderColor:"red"},"@Gecko|opera":{MozBorder:"initial",borderColor:"black",borderStyle:"outset!important"}},spinner:{textAlign:"right",width:"5em",paddingRight:"19px!important",backgroundImage:"url(%1spinner.png)!important"},"@WebKit|opera":{"input[type=range]":{background:"initial",height:"initial",padding:"initial",border:"initial"}}};forEach.detect(styleSheet,function(e,f){if(/,/.test(f)){forEach.csv(f,partial(arguments.callee,e))}else{if(/^[\w-]+$/.test(f)){f="."+f}var g=css[f];if(!g)g=css[f]=extend({toString:_r},_q);forEach.detect(e,function(c,d){if(c=="initial"){forEach(g,function(a,b){if(b.indexOf(d)==0){delete g[b]}});delete g[d]}else{g[d]=c}})}});new Theme(chrome.theme);var Chrome=Behavior.extend({oncontentready:function(a){if(a.clientHeight>a.clientWidth){this.setOrientation(a,this.VERTICAL)}this.layout(a,this.states[a.disabled?"disabled":"normal"])},onmousedown:function(a,b,c,d){Chrome._7=a;if(!this.isEditable(a))return;Chrome._0=this.hitTest(a,c,d);if(Chrome._0){this.setCapture(a)}this.layout(a)},onmouseup:function(a,b){delete Chrome._7;if(Chrome._0){delete Chrome._0;this.layout(a)}this.releaseCapture(a)},onmousemove:function(a,b,c,d){var e=this.hitTest(a,c,d);if(e!=Chrome._2){Chrome._2=e;this.layout(a)}},onmouseover:function(a,b,c,d){Chrome._6=a;Chrome._2=this.hitTest(a,c,d);this.layout(a)},onmouseout:function(a){delete Chrome._0;delete Chrome._2;delete Chrome._6;this.layout(a)},onfocus:function(a){Chrome._9=a;this.layout(a)},onblur:function(a){delete Chrome._9;this.removeClass(a,this.appearance+_g);this.layout(a)}},{HORIZONTAL:0,VERTICAL:1,states:{normal:0,hover:1,active:2,disabled:3,length:4},appearance:"",imageWidth:17,isActive:function(a){return Chrome._0&&(Chrome._0==Chrome._2)},isEditable:function(a){return!a.disabled&&!a.readOnly},isNativeControl:False,getCursor:function(a){return(Chrome._0||Chrome._2||a!=Chrome._6)?"default":""},syncCursor:function(a){a.style.cursor=this.getCursor(a)},getState:K(0),hitTest:function(a,b){var c=false;return c?b<=this.imageWidth:b>=a.clientWidth-this.imageWidth},setOrientation:function(a,b){if(b==this.VERTICAL){_b[a.base2ID]=true;this.setCSSProperty(a,"background-image","url("+chrome.host+chrome.theme+"/"+this.appearance+"-vertical.png)",true)}else{delete _b[a.base2ID];a.style.backgroundImage=""}},hasTimer:function(a,b){b=a.base2ID+(b||_c);return!!_5[b]},startTimer:function(a,b,c,d){b=a.base2ID+(b||_c);if(!_5[b]){_5[b]=setInterval(bind(this.tick,this,a),100)}},stopTimer:function(a,b){b=a.base2ID+(b||_c);if(_5[b]){clearInterval(_5[b]);delete _5[b]}},tick:Undefined,layout:function(a,b){if(b==null)b=this.getState(a);var c=a.clientHeight;var d=-this.states.length*(c/2*(c-1));d-=c*b;a.style.backgroundPosition="right "+d+PX;this.syncCursor(a)},handleEvent:function(a,b,c){if(Chrome._3){if(/^mouse(up|move)$/.test(c)){this.base(Chrome._k,b)}}else if(!this.isNativeControl(a)){this.base(a,b)}},setCapture:function(b){if(!Chrome._3){var c=this;Chrome._k=b;Chrome._3=function(a){if(_p)getSelection().collapse(document.body,0);c.handleEvent(b,a,a.type)};this.addEventListener(document,"mouseup",Chrome._3,true);this.addEventListener(document,"mousemove",Chrome._3,true)}},releaseCapture:function(){if(Chrome._3){this.removeEventListener(document,"mouseup",Chrome._3,true);this.removeEventListener(document,"mousemove",Chrome._3,true);delete Chrome._3;delete Chrome._k}},"@MSIE":{setCapture:function(a){a.setCapture();behavior=this;a.attachEvent("onlosecapture",function(){if(Chrome._3)behavior.onmouseup(a);a.detachEvent("onlosecapture",arguments.callee)});this.base(a)},releaseCapture:function(){this.base();document.releaseCapture()}}});var ComboBox=Chrome.extend({onmousedown:function(a,b,c){base(this,arguments);if(this.isEditable(a)){if(!Chrome._1){Chrome._1=this.createPopup()}if(Chrome._1){if(this.hitTest(a,c)){if(Chrome._1.isOpen){Chrome._1.hide()}else{Chrome._1.show(a)}}}}},onkeydown:function(a,b,c){if(this.isEditable(a)){var d=c==38||c==40;if(!Chrome._1&&d){Chrome._1=this.createPopup()}if(Chrome._1){if(c==27){Chrome._1.hide()}else if(d&&!Chrome._1.isOpen){Chrome._1.show(a);b.preventDefault()}else if(Chrome._1.isOpen){Chrome._1.onkeydown();b.preventDefault()}return}}},onkeyup:function(a){if(this.isActive(a))Chrome._1.onkeyup()}},{appearance:"menulist","@Safari.+theme=aqua":{layout:function(a){this.syncCursor(a)}},createPopup:function(){return new Popup(this)},isActive:function(a){return Chrome._1&&Chrome._1.isOpen},getState:function(a){if(a.disabled){var b="disabled"}else if(a.readOnly){b="normal"}else if(a==Chrome._7&&Chrome._0){b="active"}else if(a==Chrome._6&&Chrome._2){b="hover"}else{b="normal"}return this.states[b]}});var Range=Chrome.extend({onattach:function(a){var b=this.getAttributes(a);var c=a.value,d=b.min;if(!c||isNaN(c))c=d;_a[a.base2ID]=(c-d)/(b.max-d);a.onscroll=_t},onmousewheel:function(a,b,c){if(this.isEditable(a)&&Chrome._9==a){this.increment(a,-parseInt(c/40));b.preventDefault()}}},{ATTRIBUTES:{min:"",max:"",step:1},getAttributes:function(a){var b={};for(var c in this.ATTRIBUTES){var d=a[c];if(d==null&&a.hasAttribute&&a.hasAttribute(c)){d=a.getAttribute(c)}if(!d||isNaN(d))d=this.ATTRIBUTES[c];b[c]=d}return b},increment:function(a,b,c){var d=c?"Block":"Unit";b*=this["get"+d+"Increment"](a);this.setValue(a,this.getValue(a)+b)},getBlockIncrement:function(a){return this.getUnitIncrement(a)*10},getUnitIncrement:function(a){return this.getAttributes(a).step||1},getValue:function(a){return parseFloat(a.value)},setValue:function(a,b){var c=this.getAttributes(a);if(isNaN(b))b=0;var d=parseFloat(c.min),e=parseFloat(c.max),f=parseFloat(c.step)||1;b=b>e?e:b<d?d:b;b=Math.round(b/f)*f;b=b.toFixed(String(f).replace(/^.*\.|^\d+$/,"").length);if(b!=a.value){a.value=b;this.dispatchEvent(a,"change")}}});var ProgressBar=Range.extend({"@!theme=aqua":{onfocus:function(a){if(a!=Chrome._7){this.addClass(a,this.appearance+_g)}this.base(a)}},onkeydown:function(a,b,c){if(!this.isEditable(a))return;if(c<33||c>40)return;var d=1;switch(c){case 35:var e=1;case 36:this.setValue(a,e||0);return;case 33:var f=true;break;case 34:f=true;case 37:case 40:d=-1}this.increment(a,d,f)}},{HEIGHT:3000,WIDTH:3000,CHUNK_WIDTH:10,CHUNK_HEIGHT:10,ATTRIBUTES:{min:0,max:100,step:1},appearance:"progressbar",hitTest:False,getBlockIncrement:function(a){var b=this.getUnitIncrement(a);return Math.max(2*b,Math.round(0.1/b)*b)},getUnitIncrement:function(a){var b=this.getAttributes(a);return b.step/(b.max-b.min)||this.base(a)},layout:function(a){var b=a.clientWidth;var c=a.clientHeight;var d=a.base2ID;if(_b[d]){var e=(-b/2)*(b+3)-2;var f=Math.floor(c*_a[d]);f=c-Math.round(f/this.CHUNK_HEIGHT)*this.CHUNK_HEIGHT}else{var g=/luna/.test(chrome.theme)?this.CHUNK_WIDTH:1;e=Math.floor(b*_a[d])-this.WIDTH;e=Math.round(++e/g)*g;f=(-c/2)*(c+3)-2}a.style.backgroundPosition=e+PX+" "+f+PX},getCursor:K(""),getValue:function(a){return _a[a.base2ID]},setValue:function(a,b){var c=this.getAttributes(a);var d=Number(c.min),e=Number(c.max);this.base(a,d+(e-d)*b);_a[a.base2ID]=(a.value-d)/(e-d);this.layout(a)}});var Slider=ProgressBar.extend({onmousedown:function(a,b,c,d,e,f){base(this,arguments);b.preventDefault();if(!this.isEditable(a))return;if(Chrome._0){var g=this.getThumbRect(a);Chrome._d={dx:e-g.left,dy:f-g.top};Chrome._8=true}else{this.startTimer(a);Chrome._l=c;Chrome._m=d}a.focus()},"@theme=aqua":{onblur:function(a){if(a==Slider._f){delete Slider._f}base(this,arguments)},onmousedown:function(a){Slider._f=a;base(this,arguments)}},onmouseup:function(a,b){this.base(a,b);delete Chrome._d;if(!Chrome._8)this.tick(a);this.stopTimer(a);delete Chrome._l;delete Chrome._m;delete Chrome._4;delete Chrome._8},onmousemove:function(a,b,c,d,e,f){if(Chrome._d){var g=a.clientWidth;var i=a.clientHeight;if(g>=i){var h=g-this.THUMB_WIDTH;var j=e-Chrome._d.dx}else{h=i-this.THUMB_HEIGHT;j=h-f+Chrome._d.dy}this.setValue(a,j/h)}else{base(this,arguments)}}},{HORIZONTAL_WIDTH:3000,HORIZONTAL_HEIGHT:21,VERTICAL_WIDTH:22,VERTICAL_HEIGHT:3000,THUMB_WIDTH:11,THUMB_HEIGHT:11,appearance:"slider","@KHTML|opera[91]":{isNativeControl:function(a){return a.nodeName=="INPUT"&&a.type=="range"}},layout:function(a,b){if(b==null)b=this.getState(a);var c=this.getThumbRect(a);if(_b[a.base2ID]){var d=c.left;var e=c.top-Math.ceil((this.VERTICAL_HEIGHT-this.THUMB_HEIGHT)/2)-b*this.VERTICAL_HEIGHT}else{d=c.left-Math.ceil((this.HORIZONTAL_WIDTH-this.THUMB_WIDTH)/2)-b*this.HORIZONTAL_WIDTH;e=c.top}a.style.backgroundPosition=d+PX+" "+e+PX},getThumbRect:function(a){var b=a.clientWidth,c=a.clientHeight,d=_a[a.base2ID];if(_b[a.base2ID]){return new Rect((b-this.VERTICAL_WIDTH)/2,(c-=this.THUMB_HEIGHT)-Math.floor(c*d),this.VERTICAL_WIDTH,this.THUMB_HEIGHT)}else{return new Rect(Math.floor((b-this.THUMB_WIDTH)*d),Math.floor((c-this.HORIZONTAL_HEIGHT)/2),this.THUMB_WIDTH,this.HORIZONTAL_HEIGHT)}},hitTest:function(a,b,c){if(a.disabled||this.isNativeControl(a))return null;return this.getThumbRect(a).contains(b,c)},getState:function(a){if(a.disabled){var b="disabled"}else if(a==Chrome._7&&Chrome._0){b="active"}else if(a==Chrome._9||(a==Chrome._6&&Chrome._2)){b="hover"}else{b="normal"}return this.states[b]},"@theme=aqua":{getState:function(a){if(a.disabled){var b="disabled"}else if(a==Chrome._7&&Chrome._0){b="active"}else if(a==Chrome._9&&a!=Slider._f){b="hover"}else{b="normal"}return this.states[b]},startTimer:function(a){},tick:Undefined},tick:function(a){var b=this.getThumbRect(a);if(_b[a.base2ID]){var c=Chrome._m;if(c<b.top&&false!=Chrome._4){this.increment(a,1,true);Chrome._4=true}else if(c>b.top+this.THUMB_HEIGHT&&true!=Chrome._4){this.increment(a,-1,true);Chrome._4=false}}else{var d=Chrome._l;if(d<b.left&&true!=Chrome._4){this.increment(a,-1,true);Chrome._4=false}else if(d>b.left+this.THUMB_WIDTH&&false!=Chrome._4){this.increment(a,1,true);Chrome._4=true}}Chrome._8=true}});var Spinner=Range.extend({onkeydown:function(a,b,c){if(!this.isEditable(a))return;if(!/^(3[34568]|40)$/.test(c))return;b.preventDefault();switch(c){case 35:if(a.max)this.setValue(a,a.max);return;case 36:if(a.min)this.setValue(a,a.min);return;case 34:var d=true;break;case 33:d=true;case 38:var e="up"}this.activate(a,e||"down",d)},onkeyup:function(a,b,c){if(!this.isEditable(a))return;this.stopTimer(a);switch(c){case 33:case 34:case 38:case 40:b.preventDefault();this.deactivate(a);break}},onmousedown:function(a){base(this,arguments);if(Chrome._0){this.startTimer(a)}},onmouseup:function(a,b){this.stopTimer(a);this.base(a,b)}},{appearance:"spinner",states:{normal:0,up_hover:1,up_active:2,down_hover:3,down_active:4,disabled:5,length:6},"@opera[91]":{isNativeControl:function(a){return a.nodeName=="INPUT"&&a.type=="number"}},activate:function(a,b,c){Chrome._0=Chrome._2=b;this.layout(a);Chrome._j=c;this.startTimer(a,_e)},deactivate:function(a){this.stopTimer(a,_e);delete Chrome._0;delete Chrome._2;delete Chrome._j;this.layout(a)},getState:function(a){if(a.disabled){var b="disabled"}else if(a.readOnly){b="normal"}else if((a==Chrome._6||a==Chrome._9)&&Chrome._0){b=Chrome._0+_e}else if(a==Chrome._6&&Chrome._2){b=Chrome._2+_o}else{b="normal"}return this.states[b]},hitTest:function(a,b,c){if(!this.base(a,b))return null;return c<=(a.clientHeight/2)?"up":"down"},startTimer:function(a){if(!_5[a.base2ID+_c]){Chrome._s=(Chrome._0=="up")?1:-1;Chrome._n=1;this.base(a)}},stopTimer:function(a){if(_5[a.base2ID+_c]){this.base(a);if(!Chrome._8)this.increment(a);delete Chrome._8;a.select()}},tick:function(a){this.increment(a);Chrome._n*=1.1},increment:function(a,b,c){if(b==undefined){b=parseInt(Chrome._n*Chrome._s);c=!!Chrome._j}this.base(a,b,c);Chrome._8=true}});var _h="left:%1px!important;top:%2px!important;width:%3px!important;";var Popup=Base.extend({constructor:function(a){this.owner=a;var b=this.popup=document.createElement("chrome");b.className=this.appearance;b.innerHTML=this.html},appearance:"popup",isOpen:false,inherit:String2.csv("backgroundColor,color,fontFamily,fontSize,fontWeight,fontStyle"),html:"<div>1 thousand</div><div>2 thousand</div><div>3 thousand</div><div>4 thousand</div><div>5 thousand</div>",onkeydown:Undefined,onkeyup:Undefined,hide:function(){this.popup.parentNode.removeChild(this.popup);this.isOpen=false},movesize:function(a){this.popup.style.cssText=format(_h,a.offsetLeft,a.offsetTop+a.offsetHeight,a.offsetWidth-2);a.offsetParent.appendChild(this.popup)},show:function(b){this.isOpen=true;this.movesize(b);var c=this.popup.style;var d=Behavior.getComputedStyle(b);forEach(this.inherit,function(a){c[a]=d[a]});if(c.backgroundColor=="transparent"){c.backgroundColor="Window"}c.display="block"},"@MSIE":{movesize:function(a){var b=document.compatMode!="CSS1Compat"?document.body:document.documentElement;var c=a.getBoundingClientRect();this.popup.style.cssText=format(_h,b.scrollLeft+c.left-2,b.scrollTop+c.bottom-2,a.offsetWidth-2);document.body.appendChild(this.popup)}}});var Rect=Base.extend({constructor:function(a,b,c,d){this.left=a;this.top=b;this.width=c;this.height=d;this.right=a+c;this.bottom=b+d},contains:function(a,b){with(this)return a>=left&&a<=right&&b>=top&&b<=bottom},toString:function(){return[this.left,this.top,this.width,this.height].join(",")}});chrome.rules=new RuleList({"input.combobox":ComboBox,"input.progressbar":ProgressBar,"input.slider":Slider,"input.spinner":Spinner});eval(this.exports)};